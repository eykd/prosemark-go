;===============================================================
; A clean project produces no diagnostics and exits successfully.
;===============================================================
GIVEN a project where all outline references point to existing files.
GIVEN all node files have valid metadata.

WHEN the author runs the project integrity check.

THEN no errors or warnings are reported.
THEN the command exits successfully.

;===============================================================
; A missing referenced file is reported as an error.
;===============================================================
GIVEN a project where the outline references a file that does not exist on disk.

WHEN the author runs the project integrity check.

THEN an AUD001 diagnostic is reported for the missing file.
THEN the command exits with an error code.

;===============================================================
; A node file not referenced in the outline is reported as a warning.
;===============================================================
GIVEN a project containing a node file (with a node-identity filename) that is not referenced in the outline.
GIVEN a non-node filename also exists in the project directory and is not referenced in the outline.

WHEN the author runs the project integrity check.

THEN an AUD002 warning is reported for the unreferenced node file.
THEN no warning is reported for the non-node filename.
THEN the command exits successfully.

;===============================================================
; A file referenced more than once in the outline is reported as an error.
;===============================================================
GIVEN a project where the same file appears twice in the outline.

WHEN the author runs the project integrity check.

THEN an AUD003 diagnostic is reported for the duplicate reference.
THEN the command exits with an error code.

;===============================================================
; A node file whose identity field does not match its filename is reported as an error.
;===============================================================
GIVEN a node file whose identifier in the metadata does not match the identifier in the filename.

WHEN the author runs the project integrity check.

THEN an AUD004 diagnostic is reported for the identity mismatch.
THEN the command exits with an error code.

;===============================================================
; A node file missing required metadata fields is reported as an error.
;===============================================================
GIVEN a node file that is missing one or more required metadata fields.

WHEN the author runs the project integrity check.

THEN an AUD005 diagnostic is reported for the missing fields.
THEN the command exits with an error code.

;===============================================================
; A node file with no prose content is reported as a placeholder warning.
;===============================================================
GIVEN a node file with valid metadata but no prose content after the metadata block.

WHEN the author runs the project integrity check.

THEN an AUD006 warning is reported indicating the chapter has no content.
THEN the command exits successfully.

;===============================================================
; Diagnostics can be output as a structured list for tooling.
;===============================================================
GIVEN a project with integrity errors.

WHEN the author runs the project integrity check requesting structured output.

THEN the output is a structured list of diagnostic items.
THEN each item has a diagnostic code, a human-readable message, and the affected file path.

;===============================================================
; A project with only placeholder warnings exits successfully.
;===============================================================
GIVEN a project where every node file has valid metadata but no prose content.

WHEN the author runs the project integrity check.

THEN AUD006 warnings are reported for each empty node.
THEN the command exits successfully.

;===============================================================
; A project with only orphan warnings exits successfully.
;===============================================================
GIVEN a project where some node files are not referenced in the outline.

WHEN the author runs the project integrity check.

THEN AUD002 warnings are reported for the unreferenced nodes.
THEN the command exits successfully.

;===============================================================
; A non-node filename in the outline is reported as a warning but not an error.
;===============================================================
GIVEN a project outline that includes a link to a file with a non-node filename.

WHEN the author runs the project integrity check.

THEN a warning is emitted about the non-node filename.
THEN the command does not exit with an error code due to this warning alone.

;===============================================================
; A node file with unreadable metadata is reported as an error.
;===============================================================
GIVEN a node file whose metadata block cannot be parsed.

WHEN the author runs the project integrity check.

THEN an AUD007 diagnostic is reported for the unparseable metadata.
THEN the command exits with an error code.
